---
title: Identifying Priority Conservation Areas in the Florida Everglades for Mangrove Habitat
subtitle: Final Project, ENV 872
author: Isaac Benaka, Hanna Bliska, and Caroline Rowley
date: Fall 2022
output:
 pdf_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Set your working directory
setwd("~/Desktop/BenakaBliskaRowley_ENV872_EDA_FinalProject")
getwd()

# Load your packages
library(tidyverse)
library(lubridate)
library(scales)
library(cowplot)
library(trend)
library(zoo)
library(Kendall)
library(sf)
library(mapview)
library(agricolae)

# Set your ggplot theme
my_theme <- theme_classic(base_size=12) + theme(
  axis.text=element_text(color="black"), 
  legend.position="right")
theme_set(my_theme)

# Load your datasets
FCE.site.coordinates <- read.csv("./Data/Raw/FCE_LTER_site_coordinates.csv")
FCE.nutrients.data <- read.csv("./Data/Raw/FCE_LTER_Nutrients.csv",
                               stringsAsFactors = TRUE)
FCE.tree.data <- read.csv("./Data/Raw/FCE_LTER_Mangroves.csv",
                          stringsAsFactors = TRUE)
```

# Exploratory Analysis 

```{r, site analysis for nutrients}
#running anova to see if particular sites have more nitrogen
nitrogen.site.anova <- aov(data=FCE.site.nutrient.data, 
                           TN ~ SITE_NAME)
summary(nitrogen.site.anova)

#evaluating groups
nitrogen.site.anova.groups <- HSD.test(nitrogen.site.anova, 
                                       "SITE_NAME", 
                                       group = TRUE)
#printing groups
nitrogen.site.anova.groups

#results indicate that there are three groups of sites: a, b, and c.

#running anova to see if particular sites have more phosphorus
phos.site.anova <- aov(data=FCE.site.nutrient.data, 
                           TP ~ SITE_NAME)
summary(phos.site.anova)

#evaluating groups
phos.site.anova.groups <- HSD.test(phos.site.anova, 
                                       "SITE_NAME", 
                                       group = TRUE)
#printing groups
phos.site.anova.groups

#results indicate that there are four groups of sites: a, b, c, d. There is only one site that is in group a and only one site in group b. 
```

```{r, time series analysis for phosphorus}
FCE.phos.monthly.data$MEAN_TP <- 
  na.approx(FCE.phos.monthly.data$MEAN_TP) #using`na.approx`
#to fill in missing monthly data

FCE.phos.monthly.ts <- ts(
  FCE.phos.monthly.data$MEAN_TP, 
  start=c(2001,5), end=c(2021,12),frequency=12) 
#generating time series object
#monthly measurements, using 12

FCE.phos.monthly.ts.decomposed <- stl(
  FCE.phos.monthly.ts, s.window = "periodic") 
#decomposing daily time series
plot(FCE.phos.monthly.ts.decomposed) #plotting components

#running mann kendall
FCE.phos.monthly.ts.trend <- MannKendall(FCE.phos.monthly.ts) 
#using `MannKendall` for trend analysis
summary(FCE.phos.monthly.ts.trend) #summary

```

```{r, time series analysis for nitrogen}
FCE.nitro.monthly.data$MEAN_TN <- 
  na.approx(FCE.nitro.monthly.data$MEAN_TN) #using`na.approx`
#to fill in missing monthly data

FCE.nitro.monthly.ts <- ts(
  FCE.nitro.monthly.data$MEAN_TN, 
  start=c(2001,5), end=c(2021,12),frequency=12) 
#generating time series object
#monthly measurements, using 12

FCE.nitro.monthly.ts.decomposed <- stl(
  FCE.nitro.monthly.ts, s.window = "periodic") 
#decomposing daily time series
plot(FCE.nitro.monthly.ts.decomposed) #plotting components

#running mann kendall
FCE.nitro.monthly.ts.trend <- MannKendall(FCE.nitro.monthly.ts) 
#using `MannKendall` for trend analysis
summary(FCE.nitro.monthly.ts.trend) #summary
```

```{r, visualizations of time series results for nutrients}
plot.mean.monthly.phos <- ggplot(
  FCE.phos.monthly.data, aes(
    x=Date, y=MEAN_TP)) + #setting axes
  geom_point() + #generating scatter plot
  geom_line() + #generating line plot
  scale_x_date(date_breaks="1 year", labels=date_format("%m-%Y")) +
  #using `scale_x_date` to generate a break every 6 months
  #labels to show month-date-year
  theme(axis.text.x=element_text(angle=60, hjust=1)) + 
  #angle for the day-month-year labels
  xlab(expression("Date")) + #setting x axis label
  ylab(expression ("Mean Monthly Phosphorus Levels (mcmol/L)")) +
#setting y axis label
  geom_smooth(method=lm, se = FALSE, color="red") + #adding linear trend
  ggtitle(expression("Mean Monthly Phosphorus Levels"),
          subtitle="Florida Coastal Everglades")
print(plot.mean.monthly.phos) #printing plot

plot.mean.monthly.nitro <- ggplot(
  FCE.nitro.monthly.data, aes(
    x=Date, y=MEAN_TN)) + #setting axes
  geom_point() + #generating scatter plot
  geom_line() + #generating line plot
  scale_x_date(date_breaks="1 year", labels=date_format("%m-%Y")) +
  #using `scale_x_date` to generate a break every 6 months
  #labels to show month-date-year
  theme(axis.text.x=element_text(angle=60, hjust=1)) + 
  #angle for the day-month-year labels
  xlab(expression("Date")) + #setting x axis label
  ylab(expression ("Mean Monthly Nitrogen Levels (mcmol/L)")) +
#setting y axis label
  geom_smooth(method=lm, se = FALSE, color="red") + #adding linear trend
  ggtitle(expression("Mean Monthly Nitrogen Levels"),
          subtitle="Florida Coastal Everglades")
print(plot.mean.monthly.nitro) #printing plot

```


```{r, plots of mangrove DBH over time by site}
# SRS4
plot_grid(R.SRS4.plot, C.SRS4.plot, L.SRS4plot,  ncol=1)

#SRS5
plot_grid(R.SRS5.plot, A.SRS5.plot, L.SRS5.plot, ncol=1)

#SRS6
plot_grid(R.SRS6.plot, A.SRS6plot, L.SRS6plot, ncol=1)

```

