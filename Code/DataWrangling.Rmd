---
title: Identifying Priority Conservation Areas in the Florida Everglades for Mangrove Habitat
subtitle: Final Project, ENV 872
author: Isaac Benaka, Hanna Bliska, and Caroline Rowley
date: Fall 2022
output:
 pdf_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Set your working directory
setwd("~/Desktop/BenakaBliskaRowley_ENV872_EDA_FinalProject")
getwd()

# Load your packages
library(tidyverse)
library(lubridate)
library(scales)
library(cowplot)
library(trend)
library(zoo)
library(Kendall)
library(sf)
library(mapview)
library(agricolae)

# Set your ggplot theme
my_theme <- theme_classic(base_size=12) + theme(
  axis.text=element_text(color="black"), 
  legend.position="right")
theme_set(my_theme)

# Load your datasets
FCE.mean.sea.levels <- read.csv("./Data/Raw/FCE_KeyWestStation_MeanSeaLevels.csv",
                                stringsAsFactors = TRUE)
FCE.site.coordinates <- read.csv("./Data/Raw/FCE_LTER_site_coordinates.csv",
                                 stringsAsFactors = TRUE)
FCE.nutrients.data <- read.csv("./Data/Raw/LT_ND_Grahl_002.csv",
                               stringsAsFactors = TRUE)
FCE.sawgrass.data <- read.csv("./Data/Raw/LT_PP_Grahl_001.csv",
                              stringsAsFactors = TRUE)
FCE.tree.data <- read.csv("./Data/Raw/LT_PP_Rivera_002.csv",
                          stringsAsFactors = TRUE)
mangrove.sf <- st_read("./Data/Spatial/Mangrove_Habitat_in_Florida/Mangrove_Habitat_in_Florida.shp")
park.boundary <- st_read("./Data/Spatial/park/nps_boundary.shp") %>% filter(UNIT_NAME == "Everglades National Park")
# Project spatial data to UTM 17N
mangrove.utm <- st_transform(mangrove.sf,32617)
park.utm <- st_transform(park.boundary,32617)
```


# Data Wrangling
```{r, renaming the columns for the data sets}
colnames(FCE.mean.sea.levels) <- c(
  "Station_ID", "Year", "Month", "MSL") #renaming the column names
FCE.mean.sea.levels=FCE.mean.sea.levels[-1,]
#removing the repeated header row

colnames(FCE.nutrients.data) <- c(
  "SITE_NAME", "DATE", "TIME", "Salinity", "TN", "TP",
  "TOC", "NH4", "NandN", "NO2", "SRP", "DOC", "NO3") #renaming the column names
FCE.nutrients.data=FCE.nutrients.data[-1,]
#removing the repeated header row

colnames(FCE.sawgrass.data) <- c(
  "SITE_NAME", "DATE", "Sawgrass_AG_Biomass", "Sawgrass_AG_Biomass_STD",
  "Sawgrass_Culm_Density", "Sawgrass_Culm_Density_STD")
FCE.sawgrass.data=FCE.sawgrass.data[-1,]

colnames(FCE.site.coordinates) <- c(
  "SITE", "Latitude (Decimal Degrees)", "Longitude (Decimal Degrees)",
  "Latitude (Degrees, minutes)", "Longitude (Degrees, minutes)",
  "Northing (UTM)", "Easting (UTM)")
FCE.site.coordinates=FCE.site.coordinates[-1,]

colnames(FCE.tree.data) <- c(
  "SITE", "DATE", "Plot_ID", "Tree_TagNumber",
  "Species.Tree", "Tree_DBH", "Tree_Height")
FCE.tree.data=FCE.tree.data[-1,]

```

```{r, formatting nutrients data set}
FCE.nutrients.data$DATE <- as.Date(FCE.nutrients.data$DATE, format="%Y-%m-%d")
FCE.sawgrass.data$DATE <- as.Date(FCE.sawgrass.data$DATE, format="%Y-%m-%d")
FCE.tree.data$DATE <- as.Date(FCE.tree.data$DATE, format = "%Y-%m-%d")

FCE.nutrients.data$TP <- as.numeric(FCE.nutrients.data$TP)
FCE.nutrients.data$TN <- as.numeric(FCE.nutrients.data$TN)
FCE.tree.data$Tree_DBH <- as.numeric(FCE.tree.data$Tree_DBH)
  
```

```{r, wrangling nutrients data set for phosphorus}
FCE.phos.data <- FCE.nutrients.data %>%
  select(SITE_NAME, DATE, TP) %>%
  mutate(YEAR=year(DATE)) %>%
  group_by(YEAR) %>%
  summarise(MEAN_TP=mean(TP))

  
FCE.nitro.data <- FCE.nutrients.data %>%
  select(SITE_NAME, DATE, TN) %>%
  mutate(YEAR=year(DATE)) %>%
  group_by(YEAR) %>%
  summarise(MEAN_TN=mean(TN))
  
  
```

```{r, wrangling and plotting DBH tree data by species}
#DBH for Conacarpus erectus
C.trees <- FCE.tree.data %>%
  select(DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="C") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(C.trees, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")
#DBH for Avicennia germinans
A.trees <- FCE.tree.data %>%
  select(DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="A") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(A.trees, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")
#DBH for Laguncularia racemosa
L.trees <- FCE.tree.data %>%
  select(DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="L") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(L.trees, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")
#DBH for Rhizophora mangle
R.trees <- FCE.tree.data %>%
  select(DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="R") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(R.trees, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

```

```{r, compare DBH of tree species by site}

#DBH of species in SRS4
C.trees.SRS4 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="C", SITE == "SRS4") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(C.trees.SRS4, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

L.trees.SRS4 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="L", SITE == "SRS4") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(L.trees.SRS4, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

R.trees.SRS4 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="R", SITE == "SRS4") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(R.trees.SRS4, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

#DBH of species in SRS5 (A and L increasing, R flat)
A.trees.SRS5 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="A", SITE == "SRS5") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(A.trees.SRS5, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method=lm)

L.trees.SRS5 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="L", SITE == "SRS5") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(L.trees.SRS5, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

R.trees.SRS5 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="R", SITE == "SRS5") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(R.trees.SRS5, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

#DBH of species in SRS6 (all decreasing)
A.trees.SRS6 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="A", SITE == "SRS6") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(A.trees.SRS6, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

L.trees.SRS6 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="L", SITE == "SRS6") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(L.trees.SRS6, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

R.trees.SRS6 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="R", SITE=="SRS6") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(R.trees.SRS6, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")

#DBH of species in TS/Ph8 (all increasing)
C.trees.TSPh8 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="C", SITE == "TS/Ph8") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(C.trees.TSPh8, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")
  
L.trees.TSPh8 <- FCE.tree.data %>%
  select(SITE, DATE, Species.Tree, Tree_DBH, Tree_Height) %>%
  filter(Species.Tree=="L", SITE == "TS/Ph8") %>%
  group_by(DATE) %>%
  summarise(mean.DBH=mean(Tree_DBH))
ggplot(L.trees.TSPh8, aes(x=DATE,y=mean.DBH))+
  geom_point()+
  geom_smooth(method = "lm")


```


```{r, wrangling tree data for geospatial analysis}
#FCE.tree.data <- FCE.tree.data$Species.Tree %>% recode(FCE.tree.data$Species.Tree, C="Conacarpus erectus", A="Avicennia germinans", L="Laguncularia racemosa", R="Rhizophora mangle")
FCE.site.coordinates$SITE <- as.character(FCE.site.coordinates$SITE) #convert to character.
FCE.site.coordinates$SITE <- gsub('\\s+', '', FCE.site.coordinates$SITE) #remove spaces from SITE codes to join to other datasets.
FCE.site.coordinates$SITE <- as.factor(FCE.site.coordinates$SITE) #convert back to factor.
FCE.tree.data <- merge(x=FCE.tree.data, y=FCE.site.coordinates, by="SITE", all.x = TRUE)
#make sf dataframe from tree data (not showing over basemap correctly)
tree.data.sf <- st_as_sf(FCE.tree.data, coords = c("Longitude (Decimal Degrees)","Latitude (Decimal Degrees)"), crs=32617) %>% 
  group_by(SITE, DATE) %>%
  summarize(
    meanDBH=mean(Tree_DBH)
  )
mapview(tree.data.sf)
#split tree data into separate tree types for spatial analysis

```

